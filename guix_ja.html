<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>GUIX利用ガイド - wwww.typed.cc</title><link rel="icon" href="data:,"><style>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}footer,header,main,nav{display:block}a{background:0 0}a:active,a:hover{outline:0}strong{font-weight:700}h1{font-size:2em;margin:.67em 0}pre{overflow:auto}code,pre{font-family:monospace,monospace;font-size:1em}input{color:inherit;font:inherit;margin:0}input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox]{box-sizing:border-box;padding:0}*{box-sizing:inherit}body,html{font-family:Arial,Helvetica,sans-serif;box-sizing:border-box;height:100%}body{color:#111;font-size:1.1em;line-height:1.5;background:#fff}main{display:block}h1,h2{margin:0;padding:.6em 0}li{margin:0 0 .3em}a{color:#0074d9;text-decoration:none;box-shadow:none;transition:all .3s}code{padding:.3em .6em;font-size:.8em;background:#f5f5f5}pre{text-align:left;padding:.3em .6em;background:#f5f5f5;border-radius:.2em}pre code{padding:0}label{cursor:pointer}.button{display:inline-block;text-align:center;letter-spacing:inherit;margin:0;padding:.3em .9em;vertical-align:middle;background:#0074d9;color:#fff;border:0;border-radius:.2em;width:auto;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.pseudo.button{background-color:transparent;color:inherit}.button{margin:.3em 0;cursor:pointer;transition:all .3s;border-radius:.2em;height:auto;vertical-align:baseline;box-shadow:0 0 transparent inset}.button:focus,.button:hover{box-shadow:inset 0 0 0 99em rgba(255,255,255,.2);border:0}.pseudo.button:focus,.pseudo.button:hover{box-shadow:inset 0 0 0 99em rgba(17,17,17,.1)}.button:active,.pseudo.button:active{box-shadow:inset 0 0 0 99em rgba(17,17,17,.2)}:checked+.toggle,:checked+.toggle:hover{box-shadow:inset 0 0 0 99em rgba(17,17,17,.2)}input{line-height:1.5;margin:0;height:2.1em;padding:.3em .6em;border:1px solid #ccc;background-color:#fff;border-radius:.2em;transition:all .3s;width:100%}input:focus{border:1px solid #0074d9;outline:0}[type=checkbox]{opacity:0;width:0;position:absolute;display:inline-block}nav{position:fixed;top:0;left:0;right:0;height:3em;padding:0 .6em;background:#fff;box-shadow:0 0 .2em rgba(17,17,17,.2);z-index:10000;transition:all .3s;transform-style:preserve-3d}nav .brand,nav .burger,nav .menu{float:right;position:relative;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%)}nav .brand{font-weight:700;float:left;padding:0 .6em;max-width:50%;white-space:nowrap;color:inherit}nav .menu>*{margin-right:.6em}nav .burger{display:none}@media all and (max-width:60em){nav .burger{display:inline-block;cursor:pointer;bottom:-1000em;margin:0}nav .burger~.menu,nav .show:checked~.burger{position:fixed;min-height:100%;top:0;right:0;bottom:-1000em;margin:0;background:#fff;transition:all .5s ease;transform:none}nav .burger~.menu{z-index:11}nav .show:checked~.burger{color:transparent;width:100%;border-radius:0;background:rgba(0,0,0,.2);transition:all .5s ease}nav .show~.menu{width:70%;max-width:300px;transform-origin:center right;transition:all .25s ease;transform:scaleX(0)}nav .show~.menu>*{transform:translateX(100%);transition:all 0s ease .5s}nav .show:checked~.menu>:nth-child(1){transition:all .5s cubic-bezier(.645,.045,.355,1) 0s}nav .show:checked~.menu{transform:scaleX(1)}nav .show:checked~.menu>*{transform:translateX(0);transition:all .5s ease-in-out .6s}nav .burger~.menu>*{display:block;margin:.3em;text-align:left;max-width:calc(100% - .6em)}nav .burger~.menu>a{padding:.3em .9em}}:checked+.card{font-size:0;padding:0;margin:0;border:0}.hljs{display:block;overflow-x:auto;padding:.5em;background:#f0f0f0}.hljs{color:#444}.hljs-comment{color:#888}.hljs-name{font-weight:700}.hljs-number,.hljs-string{color:#800}.hljs-symbol,.hljs-variable{color:#bc6060}.hljs-built_in{color:#397300}.hljs-meta{color:#1f7199}nav{position:absolute}footer,main{font-family:"Palatino Linotype",Palatino,"URW Palladio L","Yu Mincho",YuMincho,"Noto Serif CJK JP",serif!important;font-feature-settings:"palt";max-width:800px;padding-left:20px;padding-right:10px;margin-left:auto;margin-right:auto;margin-top:50px}code{font-family:"Lucida Console",Monaco,"Noto Mono",monospace!important}</style></head><body><header><nav><a class="brand" href="/">HOME</a><input id="bmenub" type="checkbox" class="show"><label for="bmenub" class="burger pseudo button">MENU</label><div class="menu"><a class="pseudo button" href="/profile.html">PROFILE</a></div></nav></header><main><h1>GUIX利用ガイド</h1> <h2>検証環境</h2> <pre><code class="hljs language-angelscript">Operating System: Kubuntu <span class="hljs-number">20.04</span>
カーネルバージョン: <span class="hljs-number">5.4</span><span class="hljs-number">.0</span><span class="hljs-number">-29</span>-generic
OS の種類: <span class="hljs-number">64</span>-bit
プロセッサ: <span class="hljs-number">4</span> × Intel® Core™ i5<span class="hljs-number">-4278</span>U CPU @ <span class="hljs-number">2.60</span>GHz
メモリ: <span class="hljs-number">15.5</span> GiB of RAM
</code></pre> <h2>インストール</h2> <p>GUIXのインストールには幾つかの方法があるが、標準的なLinux環境ではシェルインストーラスクリプトを使用するのが便利である。 このインストーラはダウンロードしたパッケージ郡をPGPで検査するので、実行前にGUIXの開発者のPGP公開鍵をインポートしておく必要がある。 なお、検証は管理者権限で行われるのでrootユーザのキーチェインにPGP公開鍵を保存しておく。</p> <pre><code class="hljs language-shell"><span class="hljs-meta">$</span><span class="bash"> wget -qO - <span class="hljs-string">'https://sv.gnu.org/people/viewgpg.php?user_id=15145'</span> | sudo gpg --import -</span>
</code></pre> <p>管理者権限でインストーラーを実行させる。これは<code>/gnu</code>をパッケージの保存場所に使ったり、<code>/etc</code>に設定ファイルを保存することから必要な権限である。</p> <pre><code class="hljs language-shell"><span class="hljs-meta">$</span><span class="bash"> wget -qO - <span class="hljs-string">'https://git.savannah.gnu.org/cgit/guix.git/plain/etc/guix-install.sh'</span> | sudo sh -</span>
</code></pre> <p>これでLinux環境に各種ファイルが設置され、GUIX用のユーザとデーモンが作成される。 最後に<code>~/.bashrc</code>や<code>~/.zshrc</code>に以下を追記して再読み込みする。</p> <pre><code class="hljs language-shell">echo 'source $HOME/.guix-profile/etc/profile' >> ~/.bashrc
</code></pre> <p>なお、<code>guile: warning failed to install locale</code>と表示された場合は、<a href="#troubleshooting">下記</a>を参考に対応する。</p> <h2>チャンネル</h2> <p>GUIXの公式のリポジトリはCIサーバがソースコードをダウンロードしビルドできるものしか登録できないので、 各ソフトウェア開発チームが配布している公式のビルド済みバイナリは登録できない。そこで筆者も自分用にパッケージを配布する<a href="https://github.com/nzt/guix-vanilla">チャンネル</a>を用意した。 このチャンネルはx86_64のLinux環境でしかサポートしておらずRUNPATHの設定が怪しいのでGUIX SDでは動作しない恐れがあることに注意して欲しい。このチャンネルは<code>~/.config/guix/channels/</code>に以下を追記して<code>guix pull</code>を実行することで有効化される。</p> <pre><code class="hljs language-scheme">(<span class="hljs-name">cons*</span> (<span class="hljs-name">channel</span>
        (<span class="hljs-name">name</span> <span class="hljs-symbol">'vanilla</span>)
        (<span class="hljs-name">url</span> <span class="hljs-string">"https://github.com/nzt/guix-vanilla"</span>))
       %default-channels)
</code></pre> <h2>トラブルシューティング</h2> <p>以下では日本語環境でGUIXを使用する際のよくある問題とその解決方法を示す。</p> <ol> <li> <p>コマンド<code>guix</code>を実行すると<code>guile: warning: failed to install locale</code>と表示される。</p> <p>上記のようなエラーが出るときは、guixで<code>glibc-utf8-locales</code>ではなく <strong><code>glibc-locales</code>をインストール</strong> し、 <strong>環境変数<code>GUIX_LOCPATH</code>を設定</strong>する。 これは、<code>glibc-utf8-locales</code>にはUTF-8の全てのロケールがインストールされるのではなく、欧米圏の限られたロケールしかインストールされないことから、 <code>glibc-locales</code>をインストールする必要がある。しかし、警告と同時に表示されるヒントでは、 <code>glibc-utf8-locales</code>をインストールするよう促されているため、日本語環境を使用しているユーザーは注意が必要である。</p> <pre><code class="hljs language-shell"><span class="hljs-meta">$</span><span class="bash"> guix install glibc-locales</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'export GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"'</span> >> <span class="hljs-variable">$HOME</span>/.bashrc</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.bashrc</span>
</code></pre> </li> <li> <p>コマンド<code>guix isntall</code>を実行すると<code>substitute: /gnu/store/29jhbbg1hf557x8j53f9sxd9imlmf02a-bash-minimal-5.0.7/bin/bash: warning: setlocale: LC_ALL: cannot change locale (en_US.utf8)</code>と表示される。</p> <p>上記のエラーは、guixがパッケージをインストールする際に一時的に管理者権限に昇格してパッケージをダウンロードすることが原因である。 このとき、管理者権限にGUIX用のロケールが設定されていない場合GUIXは管理者rootユーザに対して上記のエラーを出力する。そのエラーが 伝搬し一般ユーザである実行ユーザにも表示されている。従って、<strong>rootユーザに対してロケールをインストール</strong>すれば、この問題は解決する。</p> <pre><code class="hljs language-shell"><span class="hljs-meta">$</span><span class="bash"> sudo -i <span class="hljs-comment">#rootユーザになる</span></span>
<span class="hljs-meta">%</span><span class="bash"> guix install glibc-locales</span>
<span class="hljs-meta">%</span><span class="bash"> <span class="hljs-built_in">echo</span> <span class="hljs-string">'export GUIX_LOCPATH="$HOME/.guix-profile/lib/locale"'</span> >> <span class="hljs-variable">$HOME</span>/.bashrc</span>
<span class="hljs-meta">%</span><span class="bash"> <span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.bashrc</span>
</code></pre> </li> <li> <p>GUIのアプリケーションで文字化けする。</p> <p>GUIX内でのフォントのキャッシュが更新されていないことが原因です。したがって <strong><code>fontcnofig</code>と適当なフォントをインストール</strong> して<strong>フォントのキャッシュを更新</strong>することで解決します。</p> <pre><code class="hljs language-shell"><span class="hljs-meta">$</span><span class="bash"> guix instlal fontcnofig font-google-noto</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">source</span> ~/.guix-profile/etc/profile</span>
<span class="hljs-meta">$</span><span class="bash"> <span class="hljs-built_in">fc</span>-cache -fv</span>
</code></pre> </li> </ol></main><footer><p>Copyright (c) 2020 TANIGUCHI Masaya All Rights Reserved.</p><p>Please tell me on <a href="https://github.com/nzt/docs">GitHub</a> if you found any typos and misstatements.</p></footer></body></html>